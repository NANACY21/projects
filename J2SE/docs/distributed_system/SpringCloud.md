### 分布式架构概述
1. `SOA架构`:`面向服务架构`，把共同的业务逻辑抽取/抽离出来形成一个服务(微服务)，提供给其它服务接口进行调用，服务与服务之间调用使用rpc远程技术    
2. `rpc远程`:以xml方式进行通讯，传递的数据封装在xml里  
3. `微服务架构`：是SOA架构演变而来，服务之间不影响，服务独立部署  
4. `微服务架构的特征`：http协议传输数据，而不是rpc。restful风格API形式来进行通讯。json格式数据传输，而不是xml数据格式，数据采用二进制  
   微服务把每一个职责单一功能存放在独立的服务中，即独立的部署，每个服务运行在单独的进程中  
   每个服务有自己独立的数据库存储、实际上有自己独立的缓存、数据库、消息队列等资源  
   一个项目，按功能划分成子项目，这些子项目可以在相同服务器上，也可以在不同服务器上，子项目之间相互通信


### SpringCloud概述
SpringCloud是微服务系统架构的一站式解决方案  
SpringCloud是一套规范，对于分布式系统，规定了分布式系统架构应该有的组件  
在这个规范之下第三方的`Netflix公司`开发了一些组件、Spring官方也开发了一些框架/组件  
包括 第三方的`阿里巴巴`开发了一套框架/组件集合`Spring Cloud Alibaba`，这些才是SpringCloud规范的`实现`

SpringCloud是一个微服务相关规范，这个规范意图为搭建微服务架构提供一站式服务  
采用组件(框架)化机制定义一系列组件，`各类组件针对性的处理微服务中的特定问题`  
这些组件共同来构成SpringCloud微服务技术栈

SpringCloud推荐服务开发使用SpringBoot  
SpringCloud提供了一套完整的微服务解决方案，其内容包含:  
`服务治理` `注册中心` `配置管理` `断路器` `智能路由`  
`微代理` `控制总线` `全局锁` `分布式会话`等，微服务所有东西都包含了  
**所以学习SpringCloud就是学习其组件集合，而不同代SpringCloud的组件集合是不同的**


**一些分布式组件的概念**  

**服务的发现与注册**  
在服务注册与发现中，有一个`服务注册中心`，当服务器启动的时候，会把当前自己服务器的信息比如：服务地址、通讯地址等以别名方式注册到服务注册中心上  
这样服务注册中心就能找到这个服务了  
`服务消费者(使用某个服务的，调用接口的)`或`服务提供者(被使用这个服务，对外提供/暴露接口)`以该别名的方式去服务注册中心上获取到实际的服务通讯地址，让后者实现本地rpc调用远程

**搭建服务注册中心**

如果注册中心挂了，则其子节点服务提供者、服务消费者都不能用了，所以给注册中心做高可用，替换注册中心  
而SpringCloud采用节点间相互注册，即都可以作为注册中心，都可以作为服务节点，一个挂了，用另一个，方式：  
注册中心的register-with-eureka: false改成true  

注册中心主要负责服务治理，在传统rpc远程调用中，服务与服务依赖关系，管理比较复杂，所以需要使用服务治理  
管理服务与服务之间依赖关系，可以实现服务调用、负载均衡、容错等，实现服务发现与注册  



**第一代SpringCloud组件(框架)集合:SCN**
1. `分布式配置中心`:SpringCloud Config(spring官方开发)
2. `注册中心`:Netflix Eureka(Netflix公司开发)
3. `熔断器(用于服务保护)`:Netflix Hystrix(Netflix公司开发)
4. `客户端负载均衡`:Netflix Ribbon(Netflix公司开发)
5. `服务调用`:Netflix Feign(Netflix公司开发 基于ribbon和hystrix的声明式服务调用组件)
6. `网关`:Netflix Zuul(Netflix公司开发 网关组件，提供智能路由、访问过滤等功能)
7. `消息驱动`:Spring Cloud Stream(spring官方开发)
8. `链路追踪`:Spring Cloud Sleuth/Zipkin(spring官方开发)

**第二代SpringCloud组件(框架)集合:Spring Cloud Alibaba，SCA**
1. `分布式配置中心`:阿里巴巴 Nacos、携程 Apollo(阿里开发/携程开发)
2. `注册中心`:阿里巴巴 Nacos(阿里公司开发)
3. `熔断器(用于服务保护)`:阿里巴巴 Sentinel(阿里公司开发)
4. `客户端负载均衡`:阿里巴巴 Dubbo LB、Spring Cloud Loadbalancer(阿里公司开发/Spring官方开发)
5. `服务调用`:阿里巴巴 Dubbo RPC(阿里公司开发)
6. `网关`:官方 Spring Cloud Gateway(Spring官方开发)


**springCloud具体组件讲解**

**Nacos**  
服务发现与配置

**Eureka**

服务发现与注册框架 用于注册中心，其它注册中心组件:ZooKeeper Consul  阿里巴巴Nacos  
Eureka 就是一个服务发现框架 服务提供者，服务消费者，服务注册  
服务提供者/服务消费者每隔30秒向eureka server发送通知以告诉服务还存活  
如果eureka server 90秒未收到存活通知，将从服务列表移除注册(服务剔除)  

微服务或者注册中心服务信息 缓存到自己的微服务 可能造成与注册表最新信息不一致 微服务会重新获取注册表信息  
消费者定期向注册中心获取最新的服务提供者信息  
服务下线:服务停止后 向注册中心告知 注册中心移除服务  


**Netflix Ribbon**
用于客户端负载均衡  
Ribbon运行在服务消费者端，当向服务提供者(集群)进行大量调用时，可以均衡调用到服务提供者不同实例上  
和Nginx区别:在 Nginx 中请求是先进入负载均衡器，而在 Ribbon 中是先在客户端进行负载均衡才进行请求的  
关注Ribbon的几种负载均衡算法  

**Netflix Feign**
分布式系统服务间调用机制 类似rpc  
OpenFeign 也是运行在消费者端的  
消费者服务git项目中加入服务提供者方法接口类，使用Feign相关注解，直接进行调用即可  

**Netflix Hystrix**
下游服务顶不住时 上游服务停止调用 以防止系统整体阻塞(服务雪崩)  
熔断:调下游服务超出指定时间 则停止调用 服务降级:调下游方法失败调另一坨代码以代替

**Netflix Zuul**
网关，网关是系统唯一对外的入口，用于对请求进行鉴权 、限流 、 路由 、监控 等功能  
用于路由映射:原来用户调用 Consumer1 的接口 localhost:8001/studentInfo/update 这个请求， 使用网关后 localhost:9000/consumer1/studentInfo/update  
url统一前缀(yaml 配置文件配置)  
自定义路由策略:配置后访问方式:localhost:9000/zuul/FrancisQ1/studentInfo/update，不将微服务名称暴露给用户 还需要进行微服务名称屏蔽，这样就无法使用微服务名称调用了

**SpringCloud Config**
分布式配置中心，每个微服务、注册中心、组件都会有自己的配置 如果改配置文件需要找微服务再重启巨麻烦还服务不可用了  
springCloudConfig:既能对配置文件统一地进行管理，又能在项目运行时动态修改配置文件  
简单来说，Spring Cloud Config 就是能将各个 应用/系统/模块 的配置文件 存放到 统一的地方然后进行管理 (Git 或者 SVN)  
微服务只有启动的时候才会进行配置文件的加载，而Spring Cloud Config 就暴露出一个接口给启动应用来获取它所想要的配置文件  
微服务获取到配置文件然后再进行它的初始化工作

**SpringCloud Bus**
消息总线，Spring Cloud Bus 的作用就是管理和广播分布式系统中的消息  
通知客户端的配置刷新功能，即在配置中心修改了某微服务的配置文件后某微服务动态读取并更新配置.如何实现？


**在分布式系统中：如何技术选型(参考)**
1. 能否满足当前场景需求
2. 技术上手难度
3. 技术成熟度 社区成熟度